<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js"
        type="text/javascript"></script>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <h1>Test7</h1>
    <canvas id="playground" width="370" height="430"></canvas>
</body>

<script>
    //BallObject
    function BallObject(initialLocation, radius) {
        this.initialLocation = { ...initialLocation };
        this.location = {
            x: initialLocation.x,
            y: initialLocation.y
        };
        this.radius = radius;
        this.speed = { x: 0, y: 0 };
    }

    //Method of BallObject
    BallObject.prototype = {
        reset() {
            this.location.x = this.initialLocation.x;
            this.location.y = this.initialLocation.y;
        },
        update() {
            ctx.beginPath();
            ctx.arc(this.location.x, this.location.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();
            this.location.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.location.x));
            this.location.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.location.y));
        }
    };

    //Canvas
    var canvas = document.getElementById("playground");
    var ctx = canvas.getContext("2d");

    //Ball
    var Ball = new BallObject(
        {
            x: 10,
            y: 10
        },
        10
    );

    //Public
    var objectList = [Ball];

    //draw
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        //Update Object
        for (var i = 0; i < objectList.length; i++) {
            var object = objectList[i];
            object.update();
        }

        requestAnimationFrame(draw);
    }

    //handleGyroscopeData
    function handleGyroscopeData (str) {
        const regex = /x:(-?\d+)y:(-?\d+)z:(-?\d+)/;
        const match = str.match(regex);
        if (match) {
            const x = parseInt(match[1]);
            const y = parseInt(match[2]);
            const z = parseInt(match[3]);
            return { x, y, z };
        } else {
            return { x: null, y: null, z: null };
        }
    }


    ThunkableWebviewerExtension.receiveMessage(function (message) {
        const { x, y, z } = handleGyroscopeData(message);

            if (x !== null) {
                Ball.location.x -= x
            }

            if (x !== null) {
                Ball.location.y += y
            }
    });

    draw();
</script>

</html>
